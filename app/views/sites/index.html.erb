<% content_for :head do %>
	
	<script type="text/javascript">

	var IMAGES = [ "sun", "rain", "snow", "storm" ];
	var ICONS = [];
	var map = null;
	var mgr = null;

	function setupMap() {
	  if (GBrowserIsCompatible()) {
	    map = new GMap2(document.getElementById("map"));
	    map.addControl(new GLargeMapControl());
	    map.setCenter(new GLatLng(55.8667230193505, -4.24999237060547), 13);
	    map.enableDoubleClickZoom();
	    window.setTimeout(setupWeatherMarkers, 0);
	  }
	}

	function getWeatherIcon(name) {
	    var icon = new GIcon();
	    icon.image = "/images/" 
			+ name + ".png";
	    icon.iconAnchor = new GPoint(16, 16);
	    icon.infoWindowAnchor = new GPoint(16, 0);
	    icon.iconSize = new GSize(32, 32);
	    icon.shadow = "/images/" 
			+ name + "-shadow.png";
	    icon.shadowSize = new GSize(59, 32);
		return icon
	}

	function getRandomPoint() {
	  var lat = 48.25 + (Math.random() - 0.5)*14.5;
	  var lng = 11.00 + (Math.random() - 0.5)*36.0;
	  return new GLatLng(Math.round(lat*10)/10, Math.round(lng*10)/10);
	}

	function getWeatherMarkers(n) {
	  var batch = [];
	  for (var i = 0; i < n; ++i) {
	    batch.push(new GMarker(getRandomPoint(), { icon: getWeatherIcon('rain') }));
		//batch.push(new GMarker(getRandomPoint(), { }));
	  }
	  return batch;
	}

	function setupWeatherMarkers() {
	  mgr = new MarkerManager(map);
	  var batch = [];
		var tmp = 'asdf';
		$.getJSON("/sites/data.json", function(data) {
			$.each(data.items, function(i, item){
				var loc = new GLatLng(item.lat, item.long);
				var marker = new GMarker(loc, { icon: getWeatherIcon('rain')  });
				batch.push(marker);
				mgr.addMarker(marker, 3);
			});
		});
		//mgr.addMarkers(batch, 2);
	  	//mgr.addMarkers(getWeatherMarkers(20), 3);
	  //mgr.addMarkers(getWeatherMarkers(200), 6);
	  //mgr.addMarkers(getWeatherMarkers(1000), 8);
	  mgr.refresh();
	}
	</script>

	<script type="text/javascript"> 
	$(document).ready(function() {
		setupMap();
	});
		$(window).unload(function() { GUnload(); } );
	</script>
<% end %>

<table>
  <tr>
    <th>Latitude</th>
    <th>Longitude</th>
    <th>Description</th>
  </tr>

<% @sites.each do |site| %>
  <tr>
    <td><%=h site.latitude %></td>
    <td><%=h site.longitude %></td>
    <td><%=h site.description %></td>
    <td><%= link_to 'Show', site %></td>
    <td><%= link_to 'Edit', edit_site_path(site) %></td>
    <td><%= link_to 'Destroy', site, :confirm => 'Are you sure?', :method => :delete %></td>
  </tr>
<% end %>
</table>

<br />

<%= link_to 'New site', new_site_path %>

<br /><br /><br /><br /><br />


<div id="map" style="margin: 5px auto; width: 650px; height: 400px"></div>


